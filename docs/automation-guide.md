# Lark Base オートメーション設定ガイド

## 概要

Lark Base標準の**オートメーション機能**を使用して、資格期限通知や遅延タスク通知を自動化します。
ローカルサーバーやスクリプトは不要です。

---

## オートメーション機能の基本

### アクセス方法

1. Baseを開く
2. 右上の「⚡ 自動化」ボタンをクリック
3. 「+ オートメーションを作成」をクリック

### 構成要素

| 要素 | 説明 |
|-----|------|
| トリガー | 自動化を開始する条件 |
| アクション | トリガー発生時に実行する操作 |

---

## 1. 資格期限通知の設定

### 概要
資格の有効期限30日前・7日前に担当者へ自動通知

### 設定手順

#### オートメーション1: 30日前通知

1. **オートメーション作成**
   - 名前: `資格期限30日前通知`

2. **トリガー設定**
   - トリガータイプ: `レコードが指定時刻になったとき`
   - テーブル: `資格記録`
   - 日時フィールド: `有効期限`
   - タイミング: `30日前`

3. **アクション設定**
   - アクション: `Larkメッセージを送信`
   - 送信先: 管理者グループ または 指定ユーザー
   - メッセージ内容:
   ```
   ⚠️ 資格期限通知（30日前）

   従業員: {従業員}
   資格: {資格}
   有効期限: {有効期限}

   更新手続きを開始してください。
   ```

4. **保存して有効化**

#### オートメーション2: 7日前通知（緊急）

1. **オートメーション作成**
   - 名前: `資格期限7日前通知（緊急）`

2. **トリガー設定**
   - トリガータイプ: `レコードが指定時刻になったとき`
   - テーブル: `資格記録`
   - 日時フィールド: `有効期限`
   - タイミング: `7日前`

3. **アクション設定**
   - アクション: `Larkメッセージを送信`
   - メッセージ内容:
   ```
   🚨 【緊急】資格期限通知（7日前）

   従業員: {従業員}
   資格: {資格}
   有効期限: {有効期限}

   至急、更新手続きを完了してください！
   ```

---

## 2. 遅延タスク通知の設定

### 概要
工程の終了予定日を過ぎたら担当者に自動通知

### 設定手順

1. **オートメーション作成**
   - 名前: `工程遅延通知`

2. **トリガー設定**
   - トリガータイプ: `レコードが指定時刻になったとき`
   - テーブル: `工程管理`
   - 日時フィールド: `終了予定日`
   - タイミング: `当日` または `1日後`
   - 追加条件: `状態` が `完了` ではない

3. **アクション設定**
   - アクション: `Larkメッセージを送信`
   - 送信先: `担当者` フィールド（リンクの場合）
   - メッセージ内容:
   ```
   🚨 工程遅延アラート

   案件: {案件}
   工程: {工程名}
   終了予定日: {終了予定日}
   現在の進捗: {進捗率}%

   対応状況を更新してください。
   ```

---

## 3. 日次サマリーレポートの設定

### 概要
毎朝、進行中の案件状況をグループに自動送信

### 設定手順

1. **オートメーション作成**
   - 名前: `日次レポート送信`

2. **トリガー設定**
   - トリガータイプ: `固定時刻になったとき`
   - 実行スケジュール: `毎日`
   - 実行時刻: `09:00`

3. **アクション設定**
   - アクション: `Larkメッセージを送信`
   - 送信先: 管理者グループ
   - メッセージ内容:
   ```
   📊 建設業務管理 日次レポート

   本日の確認事項については
   Baseをご確認ください。

   🔗 Base URL: [リンク]
   ```

---

## 4. 新規レコード通知の設定

### 新規案件登録通知

1. **トリガー設定**
   - トリガータイプ: `新しいレコードが追加されるとき`
   - テーブル: `案件管理`

2. **アクション設定**
   - アクション: `Larkメッセージを送信`
   - メッセージ内容:
   ```
   📋 新規案件登録

   案件番号: {案件番号}
   案件名: {案件名}
   顧客: {顧客名}
   契約金額: {契約金額}
   着工日: {着工日}
   ```

### 工程ステータス変更通知

1. **トリガー設定**
   - トリガータイプ: `レコードの内容が変更されるとき`
   - テーブル: `工程管理`
   - 監視フィールド: `状態`

2. **アクション設定**
   - アクション: `Larkメッセージを送信`
   - メッセージ内容:
   ```
   ✅ 工程ステータス更新

   案件: {案件}
   工程: {工程名}
   新ステータス: {状態}
   進捗率: {進捗率}%
   ```

---

## 5. 推奨オートメーション一覧

| オートメーション名 | トリガー | 用途 |
|------------------|---------|------|
| 資格期限30日前通知 | 指定時刻（30日前） | 資格更新リマインド |
| 資格期限7日前通知 | 指定時刻（7日前） | 緊急リマインド |
| 工程遅延通知 | 指定時刻（当日） | 遅延検知 |
| 日次レポート | 固定時刻（毎日9時） | 状況把握 |
| 新規案件通知 | レコード追加時 | 情報共有 |
| 工程完了通知 | フィールド変更時 | 進捗共有 |

---

## 6. トリガータイプ一覧

| トリガー | 説明 | 用途例 |
|---------|------|-------|
| 新しいレコードが追加されるとき | レコード作成時に発火 | 新規登録通知 |
| レコードの内容が変更されるとき | 指定フィールド変更時に発火 | ステータス変更通知 |
| レコードが指定時刻になったとき | 日付フィールドの前後で発火 | 期限通知 |
| 固定時刻になったとき | 毎日/毎週/毎月の指定時刻 | 定期レポート |
| ボタンがクリックされたとき | ボタンフィールド押下時 | 手動トリガー |

---

## 7. アクション一覧

| アクション | 説明 |
|-----------|------|
| Larkメッセージを送信 | 個人/グループにメッセージ送信 |
| メールを送信 | Larkメールで送信 |
| レコードを追加 | 別テーブルにレコード作成 |
| レコードを編集 | フィールド値を自動更新 |
| Webhook送信 | 外部システムに通知 |

---

## 8. 設定のコツ

### 通知先の設定

- **固定ユーザー**: 管理者など特定の人に通知
- **フィールド参照**: `担当者`フィールドの値を動的に参照
- **グループ**: Larkグループに一斉通知

### 条件の追加

トリガーに条件を追加して、不要な通知を減らす:

```
例: 工程遅延通知
- 状態 ≠ 完了
- 状態 ≠ 保留
- 進捗率 < 100
```

### テスト方法

1. テスト用レコードを作成
2. 日付フィールドを「今日」に設定
3. オートメーションの実行ログを確認

---

## 9. トラブルシューティング

### 通知が届かない

1. オートメーションが「有効」になっているか確認
2. トリガー条件を満たしているか確認
3. 送信先ユーザーがBaseにアクセス権があるか確認

### 重複通知が届く

1. 同じ条件のオートメーションが複数ないか確認
2. トリガー条件を見直し

---

## 参考リンク

- [オートメーションのトリガー条件と実行操作の紹介](https://www.larksuite.com/hc/ja-JP/articles/559049381351)
- [Base でオートメーションを使用する](https://www.larksuite.com/hc/ja-JP/articles/360048488445)
- [自動化ワークフローを使用して Lark メッセージを送信](https://www.larksuite.com/hc/ja-JP/articles/455684281288)
