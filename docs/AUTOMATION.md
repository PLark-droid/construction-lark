# 建設業版Lark Base - 自動化ガイド

> めんどくさいことは全部自動化

---

## 自動化でできること

| 自動化 | 効果 | 設定難易度 |
|--------|-----|----------|
| 進捗アラート | 遅延を自動検知・通知 | 簡単 |
| 日報リマインダー | 入力忘れ防止 | 簡単 |
| 週次レポート | 進捗を自動集計・配信 | 中 |
| 検査期限通知 | 検査日が近づくと通知 | 簡単 |

---

## 1. Lark Base 標準の自動化

### 1-1. 条件付き書式（視覚的アラート）

#### 遅延工程を赤くする
1. `22_工程管理_小工程` を開く
2. 「ステータス」列の設定を開く
3. 条件付き書式を設定：
   - 条件：ステータス = 遅延
   - 書式：背景色を赤に

#### 進捗率で色分け
1. 「進捗率」列の設定を開く
2. 条件付き書式：
   - 0-30%：赤
   - 31-70%：黄
   - 71-100%：緑

### 1-2. ビューの活用

#### 「今週の作業」ビュー
1. `22_工程管理_小工程` で新規ビュー作成
2. フィルター設定：
   - 予定開始日 >= 今週の月曜日
   - 予定終了日 <= 今週の日曜日
3. ビュー名を「今週の作業」に

#### 「要対応」ビュー
1. `60_検査記録` で新規ビュー作成
2. フィルター設定：
   - 判定 = 要手直し
   - 是正完了日 = 空白
3. ビュー名を「要対応」に

---

## 2. Lark Flow による自動化

### 2-1. 日報リマインダー

**設定手順：**
1. Lark管理コンソール → ワークフロー → 新規作成
2. トリガー：スケジュール（毎日17:00）
3. アクション：グループにメッセージ送信
4. メッセージ内容：
   ```
   【日報入力のお願い】
   本日の作業日報の入力をお願いします。
   → https://sjpfkixxkhe8.jp.larksuite.com/base/PI7gbMT0FaQHXis3qmqjF1C4pyd
   ```

### 2-2. 検査期限通知

**設定手順：**
1. トリガー：Baseレコード更新（60_検査記録）
2. 条件：是正期限が3日以内
3. アクション：担当者にメッセージ送信
4. メッセージ内容：
   ```
   【是正期限のお知らせ】
   検査記録「{{検査項目}}」の是正期限が近づいています。
   期限：{{是正期限}}
   ```

### 2-3. 遅延アラート

**設定手順：**
1. トリガー：スケジュール（毎朝9:00）
2. 条件：Baseクエリ（小工程のステータス=遅延）
3. アクション：所長にメッセージ送信
4. メッセージ内容：
   ```
   【遅延工程アラート】
   以下の工程が遅延しています：
   {{遅延工程リスト}}
   ```

---

## 3. API自動化（上級者向け）

### 3-1. 週次レポート自動生成

```bash
# スクリプト実行
npx tsx scripts/weekly-report.ts
```

**週次レポートの内容：**
- 今週の進捗サマリー
- 工事別進捗率
- 遅延工程一覧
- 来週の予定

### 3-2. 進捗自動計算

```bash
# 小工程の進捗を集計して大工程に反映
npx tsx scripts/sync-progress.ts
```

---

## 4. 自動化スクリプト

### scripts/weekly-report.ts
週次レポートを自動生成してLarkグループに送信

### scripts/sync-progress.ts
小工程→中工程→大工程の進捗率を自動集計

### scripts/check-delays.ts
遅延工程を検出してアラート送信

### scripts/daily-reminder.ts
日報未入力の現場にリマインダー送信

---

## 5. おすすめ自動化セット

### 最小構成（必須）
1. 条件付き書式で遅延を赤く表示
2. 「今週の作業」ビュー作成
3. 日報リマインダー（17:00）

### 標準構成（推奨）
上記に加えて：
4. 検査期限通知（3日前）
5. 週次レポート（毎週月曜）
6. 遅延アラート（毎朝9時）

### フル構成（大規模現場向け）
上記に加えて：
7. 進捗自動計算（毎時）
8. 原価アラート（予算超過時）
9. 安全パトロール未実施通知

---

## トラブルシューティング

### 通知が届かない
- Larkアプリの通知設定を確認
- ワークフローが有効か確認

### レポートが生成されない
- APIトークンの有効期限を確認
- 環境変数が正しく設定されているか確認

### 条件付き書式が反映されない
- ブラウザをリロード
- フィルターがかかっていないか確認

---

## 次のステップ

- [ダッシュボード設定](./DASHBOARD.md) - 可視化の設定
- [日常業務マニュアル](./DAILY-OPERATION.md) - 詳細な操作手順
