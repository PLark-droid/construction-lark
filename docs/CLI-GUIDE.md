# Construction Lark CLI ガイド

建設業版Lark Baseのワンクリック初期化CLIの使用方法を説明します。

## 目次

- [概要](#概要)
- [初期化フロー](#初期化フロー)
- [コマンドリファレンス](#コマンドリファレンス)
- [トラブルシューティング](#トラブルシューティング)

---

## 概要

Construction Lark CLIは、Lark Baseの初期セットアップを自動化するコマンドラインツールです。

### 主な機能

- **対話形式のセットアップ**: 必要最小限の情報を入力するだけでOK
- **自動テーブル作成**: 建設業に必要な6つのテーブルを自動生成
- **リレーション設定**: テーブル間の双方向リレーションを自動設定
- **ビュー作成**: ガントチャート、カンバン、カレンダービューを自動作成
- **サンプルデータ**: テスト用のサンプルデータを簡単に投入

---

## 初期化フロー

### ステップ1: CLIの実行

```bash
npx construction-lark init
```

### ステップ2: 認証情報の入力

CLIが以下の情報を順番に尋ねます:

```
🏗️  建設業版 Lark Base セットアップ

Lark認証情報を入力してください

? Lark App ID: cli_xxxxxxxxxxxxxxxx
? Lark App Secret: ********************************
? Base App Token: bascnxxxxxxxxxxxxxxxxxxxxxxxx
```

#### 認証情報の取得方法

1. **Lark Developer Console** にアクセス
   - URL: https://open.larksuite.com/app

2. **App ID と App Secret** を確認
   - アプリを選択 → 「認証情報」タブ
   - App ID: `cli_` で始まる文字列
   - App Secret: 32文字以上のランダム文字列

3. **Base App Token** を取得
   - Larkで新規Baseを作成
   - Base右上の「...」→ 「APIを開く」→ 「App Tokenをコピー」
   - Base App Token: `bascn` または `base` で始まる文字列

### ステップ3: 認証の検証

```
✓ 認証成功
✓ Base接続成功 (既存テーブル数: 0)
```

既存テーブルがある場合は警告が表示され、続行確認を求められます。

### ステップ4: テーブル作成

```
📋 テーブルを作成中...

  ✓ 工事台帳
  ✓ 工程表
  ✓ 作業員マスタ
  ✓ 協力会社マスタ
  ✓ 資機材マスタ
  ✓ 日報

テーブル作成完了
```

### ステップ5: リレーション設定

```
🔗 リレーションを設定中...

  ✓ 14件の双方向リレーション設定完了
```

### ステップ6: ビュー作成

```
📊 ビューを作成中...

  ✓ ガントチャートビュー
  ✓ カンバンビュー
  ✓ カレンダービュー
```

### ステップ7: 環境変数ファイル生成

```
💾 環境変数ファイルを作成中...
✓ 環境変数が .env に保存されました
```

### 完了メッセージ

```
✅ セットアップ完了！

次のステップ:

1. ダッシュボードを作成
   詳細: docs/DASHBOARD.md を参照
   または: npm run dashboard:create

2. サンプルデータを投入
   コマンド: npx construction-lark sample-data

3. 運用開始！
   Lark Baseを開いて工事データを入力してください

作成されたテーブル:

  工事台帳              : tblxxxxxxxx
  工程表                : tblxxxxxxxx
  作業員マスタ          : tblxxxxxxxx
  協力会社マスタ        : tblxxxxxxxx
  資機材マスタ          : tblxxxxxxxx
  日報                  : tblxxxxxxxx

環境変数が .env に保存されました。
詳細は README.md をご確認ください。
```

---

## コマンドリファレンス

### init - ワンクリック初期化

```bash
npx construction-lark init [options]
```

**説明:**
対話形式で完全なセットアップを実行します。

**オプション:**
- `--skip-env` - .envファイルの作成をスキップ

**実行時間:** 約2-3分

**作成されるファイル:**
- `.env` - 環境変数ファイル
- `.env.backup` - 既存の.envのバックアップ（既に.envが存在する場合）

---

### sample-data - サンプルデータ投入

```bash
npx construction-lark sample-data [options]
```

**説明:**
テスト用のサンプルデータを投入します。

**オプション:**
- `-m, --minimal` - 最小限のサンプルデータのみ投入

**データセット:**

| セット | 工事台帳 | 作業員 | 協力会社 | 資機材 | 用途 |
|--------|---------|--------|---------|--------|------|
| 最小限 | 3件 | 5件 | 3件 | 5件 | 動作確認 |
| 標準 | 10件 | 20件 | 10件 | 20件 | デモ・検証 |
| 大規模 | 50件 | 100件 | 30件 | 100件 | 性能テスト |

**実行時間:**
- 最小限: 約10秒
- 標準: 約30秒
- 大規模: 約2分

---

### setup - テーブル再作成

```bash
npx construction-lark setup [options]
```

**説明:**
既存のテーブルを確認し、必要に応じてテーブルを作成します。

**オプション:**
- `-f, --force` - 既存テーブルがある場合でも強制的に再作成

**警告:** `--force` オプションは既存データを削除する可能性があります。

---

### ヘルプ・バージョン

```bash
# ヘルプ表示
npx construction-lark --help

# バージョン確認
npx construction-lark --version
```

---

## トラブルシューティング

### 認証エラー

**症状:**
```
❌ 認証失敗
エラー: Failed to get access token: ...
```

**原因:**
- App IDまたはApp Secretが間違っている
- アプリが無効化されている

**解決方法:**
1. Lark Developer Consoleで認証情報を再確認
2. アプリのステータスが「有効」であることを確認

---

### Base接続エラー

**症状:**
```
❌ Base接続失敗
エラー: Base接続失敗: ...
```

**原因:**
- Base App Tokenが間違っている
- Baseが削除されている
- アプリにBase権限がない

**解決方法:**
1. Base App Tokenを再取得
2. アプリ権限設定で「bitable」権限を確認
3. Baseの「設定」→「権限」でアプリを追加

---

### テーブル作成エラー

**症状:**
```
  ❌ 工事台帳 (失敗)
    エラー: テーブル作成失敗: ...
```

**原因:**
- Base容量が不足
- 権限不足
- 同名のテーブルが既に存在

**解決方法:**
1. Baseの容量を確認
2. アプリ権限で「テーブル作成」権限を確認
3. 既存テーブルを削除または名前を変更

---

### .env ファイルエラー

**症状:**
```
❌ .envファイルが見つかりません
```

**原因:**
- `init`コマンドを実行していない
- .envファイルが削除された

**解決方法:**
1. `npx construction-lark init` を実行
2. または手動で.envファイルを作成

---

## FAQ

### Q. 既存のBaseに追加できますか？

A. はい、可能です。既存テーブルがある場合は警告が表示され、続行確認を求められます。新しいテーブルのみが追加されます。

### Q. テーブルをカスタマイズできますか？

A. CLIで作成した後、Lark Base UIで自由にフィールドを追加・変更できます。

### Q. サンプルデータを削除したい

A. Lark Base UIから各テーブルのレコードを手動で削除してください。一括削除機能も利用できます。

### Q. エラーが発生したら？

A. エラーメッセージを確認し、上記のトラブルシューティングを参照してください。解決しない場合はGitHub Issuesで報告してください。

---

## 関連ドキュメント

- [README.md](../README.md) - プロジェクト概要
- [QUICKSTART.md](./QUICKSTART.md) - クイックスタートガイド
- [DASHBOARD.md](./DASHBOARD.md) - ダッシュボード設定ガイド
- [API.md](./API.md) - API リファレンス

---

## サポート

質問やバグ報告は以下へお願いします:

- **GitHub Issues**: https://github.com/PLark-droid/construction-lark/issues
- **Email**: support@example.com

---

最終更新: 2025-12-14
