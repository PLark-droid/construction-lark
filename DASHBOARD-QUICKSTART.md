# 工程管理ダッシュボード - クイックスタート

Lark Base APIを使った工程管理ダッシュボードを3ステップで使い始める方法です。

---

## 1. 環境設定（初回のみ）

`.env` ファイルが正しく設定されているか確認：

```bash
cat .env
```

以下の項目が設定されていればOK：

```bash
LARK_APP_ID=cli_a98f344fd6f8de1b
LARK_APP_SECRET=YiFmIRV7nc5cLwtfZOR2orPQ4uCqhJAf
LARK_BASE_APP_TOKEN=PI7gbMT0FaQHXis3qmqjF1C4pyd
```

---

## 2. 工程管理ダッシュボードを表示

```bash
npx tsx scripts/process-dashboard.ts
```

### 表示内容

1. **進捗サマリー**
   - 総工程数・完了・進行中・未着手・遅延の件数
   - 全体進捗率

2. **工程一覧（ガントチャート形式）**
   - 大工程 → 中工程 → 小工程の階層構造
   - 各工程の開始日・終了日・進捗率・ステータス

3. **機材使用状況**
   - 機材別の保有台数・使用中・空き台数
   - 稼働率とプログレスバー
   - 配置詳細（工程名・数量・期間）

4. **人員配置状況**
   - 担当者別の担当工程数
   - 工程・期間・役割の詳細

---

## 3. 機材の空き状況をチェック

```bash
npx tsx scripts/equipment-availability.ts
```

### 表示内容

1. **機材使用状況サマリー**
   - 総機材種類数・ステータス別集計
   - 総保有台数・使用中・空き台数
   - 平均稼働率

2. **カテゴリー別統計**
   - 重機・車両・足場材などカテゴリー別の集計

3. **機材別配置状況**
   - 🟢 余裕あり（空きが30%以上）
   - 🟡 残りわずか（空きが30%未満）
   - 🔴 満杯（空きなし）
   - ⚠️ オーバーアロケーション（保有台数を超過）

4. **アラート**
   - オーバーアロケーションが検出された場合に警告表示

---

## 使用シーン

### 朝礼前（5分）

工程管理ダッシュボードで今日の作業を確認：

```bash
npx tsx scripts/process-dashboard.ts
```

- 今日の工程と担当者を確認
- 機材の使用状況を確認
- 全体の進捗を把握

### 機材調達前（3分）

機材の空き状況をチェック：

```bash
npx tsx scripts/equipment-availability.ts
```

- 必要な機材が空いているか確認
- オーバーアロケーションがないか確認
- レンタル機材の必要性を判断

### 進捗報告前（2分）

進捗を自動同期してから報告：

```bash
npx tsx scripts/sync-progress.ts
npx tsx scripts/process-dashboard.ts
```

- 小工程の進捗率を中工程・大工程に反映
- 最新の進捗状況を確認

---

## 出力例

### 工程管理ダッシュボード

```
═══════════════════════════════════════════════════════════
  🏗️  工程管理ダッシュボード
═══════════════════════════════════════════════════════════

📈 進捗サマリー
────────────────────────────────────────────────────────
総工程数:        65件
完了:            20件 (31%)
進行中:          30件 (46%)
未着手:          15件 (23%)
遅延:            5件

全体進捗率:      55% ██████████████████░░░░░░░░░░░░
────────────────────────────────────────────────────────

📊 工程一覧（ガントチャート形式）
────────────────────────────────────────────────────────
工程名                              開始日         終了日         進捗率    ステータス
────────────────────────────────────────────────────────
📁 準備工                           2025-01-01     2025-01-15     100%      完了
  └─ 仮設工事                       2025-01-01     2025-01-10     100%      完了
  └─ 測量・墨出し                   2025-01-11     2025-01-15     100%      完了

📁 基礎工事                         2025-01-16     2025-02-28     60%       進行中
  └─ 掘削工事                       2025-01-16     2025-01-31     100%      完了
  └─ 基礎配筋                       2025-02-01     2025-02-15     80%       進行中
  └─ 基礎コンクリート               2025-02-16     2025-02-28     20%       進行中
────────────────────────────────────────────────────────

🏗️  機材使用状況
────────────────────────────────────────────────────────
機材名                          保有台数    使用中      空き        稼働率
────────────────────────────────────────────────────────
バックホウ(0.7m³)               5台         5台         0台         100% ████████████████████
  └─ 掘削工事 (3台) 2025-01-16 ～ 2025-01-31
  └─ 土工事 (2台) 2025-02-01 ～ 2025-02-15

クレーン(25t)                   3台         2台         1台         67%  █████████████░░░░░░░
  └─ 基礎配筋 (1台) 2025-02-01 ～ 2025-02-15
────────────────────────────────────────────────────────

👥 人員配置状況
────────────────────────────────────────────────────────
担当者名                        担当工程数
────────────────────────────────────────────────────────
山田太郎                        3件
  └─ [現場代理人] 基礎工事 (2025-01-16 ～ 2025-02-28)
  └─ [責任者] 躯体工事 (2025-03-01 ～ 2025-04-30)
────────────────────────────────────────────────────────
```

### 機材空き状況チェッカー

```
═══════════════════════════════════════════════════════════
  🔍 機材空き状況チェッカー
═══════════════════════════════════════════════════════════

📊 機材使用状況サマリー
────────────────────────────────────────────────────────
総機材種類数:    20種類

🟢 余裕あり:     10種類 (50%)
🟡 残りわずか:   5種類 (25%)
🔴 満杯:         4種類 (20%)
⚠️  オーバー:    1種類 (5%) ⚠️ 要確認

総保有台数:      50台
使用中:          35台
空き:            15台
平均稼働率:      70% ██████████████████████░░░░░░░░░░
────────────────────────────────────────────────────────

📦 カテゴリー別統計
────────────────────────────────────────────────────────
カテゴリー          種類数    保有      使用中    空き      稼働率
────────────────────────────────────────────────────────
重機                5種類     15台      12台      3台       80%  ████████████░░░
車両                3種類     10台      8台       2台       80%  ████████████░░░
足場材              4種類     15台      10台      5台       67%  ██████████░░░░░
────────────────────────────────────────────────────────

🏗️  機材別配置状況
════════════════════════════════════════════════════════
   機材名                               分類            保有    使用中  空き    稼働率             ステータス
════════════════════════════════════════════════════════
🔴 バックホウ(0.7m³)                   重機            5台     5台     0台     100% ██████████ 満杯
   └─ 掘削工事                          (3台)      2025-01-16 ～ 2025-01-31

🟡 クレーン(25t)                       重機            3台     2台     1台     67%  ██████░░░░ 残りわずか
   └─ 基礎配筋                          (1台)      2025-02-01 ～ 2025-02-15

🟢 コンクリートポンプ車                車両            2台     0台     2台     0%   ░░░░░░░░░░ 余裕あり

⚠️  足場材(枠組足場)                   足場材          100台   110台   -10台   110% ███████████ ⚠️ オーバーアロケーション
════════════════════════════════════════════════════════

⚠️  警告: オーバーアロケーションが検出されました
────────────────────────────────────────────────────────
  - 足場材(枠組足場): 保有100台に対して110台配置済み (超過: 10台)
────────────────────────────────────────────────────────
```

---

## トラブルシューティング

### Q: 認証エラーが出る

```
❌ エラーが発生しました: Error: 認証失敗
```

**A**: `.env` ファイルの `LARK_APP_ID` と `LARK_APP_SECRET` を確認してください。

### Q: データが表示されない

```
  大工程:         0件
  中工程:         0件
  小工程:         0件
```

**A**: 以下を確認してください：
1. Lark Baseにデータが登録されているか
2. テーブルIDが正しいか
3. Lark Appのアクセス権限があるか

### Q: テーブルが見つからない

```
⚠️ テーブル取得警告: table not found
```

**A**: Lark Baseの設定でテーブルIDを確認してください。

---

## 次のステップ

### 定期実行を設定

cronジョブで自動実行：

```bash
# 毎日朝9時にダッシュボード表示
0 9 * * * cd /path/to/construction-lark && npx tsx scripts/process-dashboard.ts >> /var/log/lark-dashboard.log 2>&1
```

### カスタマイズ

スクリプトを編集して独自の表示を追加：

```typescript
// scripts/process-dashboard.ts
// 表示ロジックをカスタマイズ
```

### 詳細ドキュメント

詳しい使い方は以下を参照：

- [工程管理ダッシュボードスクリプト詳細](docs/DASHBOARD-SCRIPTS.md)
- [スクリプトREADME](scripts/README.md)
- [自動化ガイド](docs/AUTOMATION.md)

---

## サポート

問題が発生した場合：

1. [トラブルシューティング](docs/DASHBOARD-SCRIPTS.md#トラブルシューティング)を確認
2. GitHubでIssueを作成: https://github.com/PLark-droid/construction-lark/issues

---

*Powered by Miyabi Agent - 全能力解放モード*
